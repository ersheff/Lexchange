<div x-data="{
  async login(e) {
    const values = Object.fromEntries(new FormData(e.target))
    try {
      await pb.collection('users').authWithPassword(values.email, values.password);
      route('?page=repertoire');
    } catch (err) {
      $store.toast.notify(err.message);
    }
  },
  async createUser(e) {
    const values = Object.fromEntries(new FormData(e.target));
    try {
      const record = await pb.collection('users').create(values);
      $store.toast.notify('Registration successful.');
      route(`?page=repertoire`);
    }
    catch {
      const msg = err?.response?.data?.email?.message === 'Value must be unique.' ? 'An account with this email already exists.' : (err?.response?.data?.password?.message || err?.response?.data?.passwordConfirm?.message || err.message);
      $store.toast.notify(msg);
    }
  }
}">

  <h2>Login/Register</h2>

  <h3>Login</h3>
  <form @submit.prevent="login($event)">
    <div class="form-group">
      <label>Email</label>
      <input type="email" name="email" required>
    </div>
    <div class="form-group">
      <label>Password</label>
      <input type="password" name="password" required>
    </div>
    <button type="submit">Login</button>
  </form>

  <h3>Register</h3>
  <form @submit.prevent="createUser($event)">
    <div class="form-group">
      <label>Email</label>
      <input type="email" name="email" required>
    </div>
    <div class="form-group">
      <label>Password</label>
      <input type="password" name="password" required>
    </div>
    <div class="form-group">
      <label>Confirm Password</label>
      <input type="password" name="passwordConfirm" required>
    </div>
    <button type="submit">Register</button>
  </form>

</div>